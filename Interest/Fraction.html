<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced Fraction Calculator (BigInt Safe)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --primary:#2563eb;
  --bg:#f4f7fb;
  --card:#ffffff;
  --radius:14px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background:var(--bg);
}
.container{
  max-width:520px;
  margin:40px auto;
  background:var(--card);
  padding:22px;
  border-radius:var(--radius);
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}
h1{
  margin-top:0;
  text-align:center;
  font-size:1.6rem;
}
.row{
  display:flex;
  gap:10px;
  margin-bottom:12px;
}
input,select,button{
  width:100%;
  padding:10px;
  font-size:1rem;
  border-radius:8px;
  border:1px solid #d0d7e2;
}
button{
  background:var(--primary);
  color:#fff;
  border:none;
  cursor:pointer;
}
button:hover{opacity:.9}
.output{
  margin-top:18px;
  padding:12px;
  background:#f1f5ff;
  border-radius:10px;
  font-size:.95rem;
}
#error{
  color:#c0392b;
  font-size:.9rem;
  margin-top:8px;
}
.section{
  margin-top:16px;
}
</style>
</head>

<body>
<div class="container">
  <h1>Fraction Calculator</h1>

  <div class="row">
    <input id="a" placeholder="a (numerator)">
    <input id="b" placeholder="b (denominator)">
  </div>

  <div class="row">
    <select id="op">
      <option value="+">+</option>
      <option value="-">−</option>
      <option value="*">×</option>
      <option value="/">÷</option>
    </select>
  </div>

  <div class="row">
    <input id="c" placeholder="c (numerator)">
    <input id="d" placeholder="d (denominator)">
  </div>

  <button onclick="calculate()">Calculate</button>
  <div id="error"></div>

  <div id="output" class="output"></div>

  <div id="formula" class="section"></div>
  <div id="steps" class="section"></div>
</div>

<script>
function gcdBig(a,b){
  a=a<0n?-a:a; b=b<0n?-b:b;
  while(b){[a,b]=[b,a%b]}
  return a;
}

function simplifyBig(n,d){
  if(d<0n){n=-n;d=-d}
  if(n===0n) return [0n,1n]
  let g=gcdBig(n,d)
  return [n/g,d/g]
}

function safeDecimal(n,d){
  if(d===0n) return "—";
  if(n.toString().length>30 || d.toString().length>30) return "Too large";
  return (Number(n)/Number(d)).toFixed(6);
}

function calculate(){
  const err=document.getElementById("error");
  err.innerText="";

  let a=document.getElementById("a").value.trim();
  let b=document.getElementById("b").value.trim();
  let c=document.getElementById("c").value.trim();
  let d=document.getElementById("d").value.trim();
  let op=document.getElementById("op").value;

  if(!a||!b||!c||!d){
    err.innerText="All fields are required.";
    return;
  }
  if(b==="0"||d==="0"){
    err.innerText="Denominator cannot be zero.";
    return;
  }

  let A=BigInt(a),B=BigInt(b),C=BigInt(c),D=BigInt(d);
  let n,m,steps="",formula="";

  if(op==="+"){
    let ad=A*D, bc=B*C;
    n=ad+bc; m=B*D;
    formula="(a/b) + (c/d) = (ad + bc) / bd";
    steps=`ad = ${A} × ${D} = ${ad}<br>
           bc = ${B} × ${C} = ${bc}<br>
           numerator = ad + bc = ${n}<br>
           denominator = bd = ${m}`;
  }

  if(op==="-"){
    let ad=A*D, bc=B*C;
    n=ad-bc; m=B*D;
    formula="(a/b) − (c/d) = (ad − bc) / bd";
    steps=`ad = ${ad}<br>
           bc = ${bc}<br>
           numerator = ad − bc = ${n}<br>
           denominator = bd = ${m}`;
  }

  if(op==="*"){
    n=A*C; m=B*D;
    formula="(a/b) × (c/d) = ac / bd";
    steps=`ac = ${A} × ${C} = ${n}<br>
           bd = ${B} × ${D} = ${m}<br>
           numerator = ${n}<br>
           denominator = ${m}`;
  }

  if(op==="/"){
    if(C===0n){
      err.innerText="Division by zero is not allowed.";
      return;
    }
    n=A*D; m=B*C;
    formula="(a/b) ÷ (c/d) = ad / bc";
    steps=`ad = ${A} × ${D} = ${n}<br>
           bc = ${B} × ${C} = ${m}<br>
           numerator = ${n}<br>
           denominator = ${m}`;
  }

  let [sn,sd]=simplifyBig(n,m);

  document.getElementById("output").innerHTML=
    `<b>Result</b><br>
     Fraction = ${sn}/${sd}<br>
     Decimal (safe) = ${safeDecimal(sn,sd)}`;

  document.getElementById("formula").innerHTML=
    `<b>Formula Used</b><br><br>${formula}`;

  document.getElementById("steps").innerHTML=
    `<b>Step-by-Step Solution</b><br><br>${steps}<br><br>
     Simplified → ${sn}/${sd}`;
}
</script>
</body>
</html>
